{% doc %}
  @prompt
    Create a conditional ingredients section block for product pages that only displays when ingredient information exists. The block should check if ingredients content is present (not empty) before rendering the ingredients heading and content. If no ingredients are available, the entire block should be hidden. Include customizable settings for the ingredients heading text and content field.
{% enddoc %}
{% assign ai_gen_id = block.id | replace: '_', '' | downcase %}

{% liquid
  assign ingredients_content = block.settings.ingredients_content | strip
  assign has_ingredients = false
  
  if ingredients_content != blank
    assign has_ingredients = true
  endif
%}

{% if has_ingredients %}
  {% style %}
    .ai-ingredients-section-{{ ai_gen_id }} {
      padding: {{ block.settings.padding_top }}px 0 {{ block.settings.padding_bottom }}px;
      background-color: {{ block.settings.background_color }};
    }

    .ai-ingredients-container-{{ ai_gen_id }} {
      max-width: {{ block.settings.max_width }}px;
      margin: 0 auto;
      padding: 0 20px;
    }

    .ai-ingredients-heading-{{ ai_gen_id }} {
      color: {{ block.settings.heading_color }};
      font-size: {{ block.settings.heading_size }}px;
      margin: 0 0 {{ block.settings.heading_spacing }}px;
      font-weight: 700;
    }

    .ai-ingredients-content-{{ ai_gen_id }} {
      color: {{ block.settings.text_color }};
      font-size: {{ block.settings.text_size }}px;
      line-height: 1.6;
    }

    .ai-ingredients-content-{{ ai_gen_id }} p {
      margin: 0 0 12px;
    }

    .ai-ingredients-content-{{ ai_gen_id }} p:last-child {
      margin-bottom: 0;
    }

    .ai-ingredients-content-{{ ai_gen_id }} ul,
    .ai-ingredients-content-{{ ai_gen_id }} ol {
      margin: 0 0 12px;
      padding-left: 20px;
    }

    .ai-ingredients-content-{{ ai_gen_id }} li {
      margin-bottom: 8px;
    }

    .ai-ingredients-content-{{ ai_gen_id }} li:last-child {
      margin-bottom: 0;
    }

    @media screen and (max-width: 749px) {
      .ai-ingredients-section-{{ ai_gen_id }} {
        padding: {{ block.settings.padding_top | times: 0.7 }}px 0 {{ block.settings.padding_bottom | times: 0.7 }}px;
      }

      .ai-ingredients-heading-{{ ai_gen_id }} {
        font-size: {{ block.settings.heading_size | times: 0.85 }}px;
      }

      .ai-ingredients-content-{{ ai_gen_id }} {
        font-size: {{ block.settings.text_size | times: 0.95 }}px;
      }
    }
  {% endstyle %}

  <div class="ai-ingredients-section-{{ ai_gen_id }}" {{ block.shopify_attributes }}>
    <div class="ai-ingredients-container-{{ ai_gen_id }}">
      {% if block.settings.heading != blank %}
        <h3 class="ai-ingredients-heading-{{ ai_gen_id }}">{{ block.settings.heading }}</h3>
      {% endif %}
      
      <div class="ai-ingredients-content-{{ ai_gen_id }}">
        {{ block.settings.ingredients_content }}
      </div>
    </div>
  </div>
{% endif %}

{% schema %}
{
  "name": "Conditional ingredients",
  "tag": null,
  "settings": [
    {
      "type": "header",
      "content": "Content"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Ingredients"
    },
    {
      "type": "richtext",
      "id": "ingredients_content",
      "label": "Ingredients content",
      "info": "Block will only display when this field has content"
    },
    {
      "type": "header",
      "content": "Style"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Background",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "heading_color",
      "label": "Heading color",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Text color",
      "default": "#000000"
    },
    {
      "type": "range",
      "id": "heading_size",
      "min": 14,
      "max": 40,
      "step": 2,
      "unit": "px",
      "label": "Heading size",
      "default": 24
    },
    {
      "type": "range",
      "id": "text_size",
      "min": 12,
      "max": 24,
      "step": 1,
      "unit": "px",
      "label": "Text size",
      "default": 14
    },
    {
      "type": "header",
      "content": "Layout"
    },
    {
      "type": "range",
      "id": "max_width",
      "min": 400,
      "max": 1200,
      "step": 50,
      "unit": "px",
      "label": "Maximum width",
      "default": 800
    },
    {
      "type": "range",
      "id": "heading_spacing",
      "min": 8,
      "max": 40,
      "step": 2,
      "unit": "px",
      "label": "Heading spacing",
      "default": 16
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Top padding",
      "default": 40
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Bottom padding",
      "default": 40
    }
  ],
  "presets": [
    {
      "name": "Conditional ingredients"
    }
  ]
}
{% endschema %}
