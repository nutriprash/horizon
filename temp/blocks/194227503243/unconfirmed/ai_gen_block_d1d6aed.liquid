{% doc %}
  @prompt
    Create a fully conditional related products block that reads from a product list metafield (named "related product data" or "product data"). The ENTIRE block must be hidden if the metafield is empty or has no products. When products exist in the metafield, display each product in a card showing: product image at top, product name below, shelf life from the product's shelf life metafield, and ingredients from the product's ingredients metafield. Use proper conditional checks to ensure the block only renders when the metafield has values. Include a customizable section heading and clean card layout with proper spacing between products.
{% enddoc %}
{% liquid
  assign related_products = product.metafields.custom.related_product_data
  if related_products == blank
    assign related_products = product.metafields.custom.product_data
  endif
%}

{% if related_products != blank and related_products.count > 0 %}
  {% assign ai_gen_id = block.id | replace: '_', '' | downcase %}

  {% style %}
    .ai-related-products-{{ ai_gen_id }} {
      padding: {{ block.settings.section_padding }}px 0;
      background-color: {{ block.settings.background_color }};
    }

    .ai-related-products-container-{{ ai_gen_id }} {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 20px;
    }

    .ai-related-products-heading-{{ ai_gen_id }} {
      text-align: {{ block.settings.heading_alignment }};
      margin-bottom: {{ block.settings.heading_spacing }}px;
      color: {{ block.settings.heading_color }};
      font-size: {{ block.settings.heading_size }}px;
    }

    .ai-related-products-grid-{{ ai_gen_id }} {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: {{ block.settings.grid_gap }}px;
    }

    .ai-related-product-card-{{ ai_gen_id }} {
      background-color: {{ block.settings.card_background }};
      border-radius: {{ block.settings.card_border_radius }}px;
      overflow: hidden;
      border: {{ block.settings.card_border_width }}px solid {{ block.settings.card_border_color }};
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .ai-related-product-card-{{ ai_gen_id }}:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
    }

    .ai-related-product-image-wrapper-{{ ai_gen_id }} {
      position: relative;
      width: 100%;
      padding-bottom: 100%;
      overflow: hidden;
      background-color: #f5f5f5;
    }

    .ai-related-product-image-{{ ai_gen_id }} {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .ai-related-product-image-placeholder-{{ ai_gen_id }} {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      background-color: #f5f5f5;
    }

    .ai-related-product-image-placeholder-{{ ai_gen_id }} svg {
      width: 60%;
      height: 60%;
      opacity: 0.3;
    }

    .ai-related-product-content-{{ ai_gen_id }} {
      padding: {{ block.settings.card_padding }}px;
    }

    .ai-related-product-title-{{ ai_gen_id }} {
      font-size: {{ block.settings.product_title_size }}px;
      font-weight: 600;
      margin: 0 0 12px 0;
      color: {{ block.settings.product_title_color }};
      line-height: 1.3;
    }

    .ai-related-product-title-{{ ai_gen_id }} a {
      color: inherit;
      text-decoration: none;
    }

    .ai-related-product-title-{{ ai_gen_id }} a:hover {
      text-decoration: underline;
    }

    .ai-related-product-meta-{{ ai_gen_id }} {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .ai-related-product-meta-item-{{ ai_gen_id }} {
      font-size: {{ block.settings.meta_text_size }}px;
      color: {{ block.settings.meta_text_color }};
      line-height: 1.4;
    }

    .ai-related-product-meta-label-{{ ai_gen_id }} {
      font-weight: 600;
      margin-right: 4px;
    }

    @media screen and (max-width: 749px) {
      .ai-related-products-grid-{{ ai_gen_id }} {
        grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
        gap: {{ block.settings.grid_gap | times: 0.7 }}px;
      }

      .ai-related-products-heading-{{ ai_gen_id }} {
        font-size: {{ block.settings.heading_size | times: 0.8 }}px;
      }

      .ai-related-product-content-{{ ai_gen_id }} {
        padding: {{ block.settings.card_padding | times: 0.8 }}px;
      }

      .ai-related-product-title-{{ ai_gen_id }} {
        font-size: {{ block.settings.product_title_size | times: 0.9 }}px;
      }

      .ai-related-product-meta-item-{{ ai_gen_id }} {
        font-size: {{ block.settings.meta_text_size | times: 0.9 }}px;
      }
    }
  {% endstyle %}

  <div class="ai-related-products-{{ ai_gen_id }}" {{ block.shopify_attributes }}>
    <div class="ai-related-products-container-{{ ai_gen_id }}">
      {% if block.settings.heading != blank %}
        <h2 class="ai-related-products-heading-{{ ai_gen_id }}">{{ block.settings.heading }}</h2>
      {% endif %}

      <div class="ai-related-products-grid-{{ ai_gen_id }}">
        {% for related_product in related_products %}
          {% if related_product != blank %}
            <div class="ai-related-product-card-{{ ai_gen_id }}">
              <div class="ai-related-product-image-wrapper-{{ ai_gen_id }}">
                {% if related_product.featured_image %}
                  <img
                    src="{{ related_product.featured_image | image_url: width: 500 }}"
                    alt="{{ related_product.featured_image.alt | escape }}"
                    class="ai-related-product-image-{{ ai_gen_id }}"
                    loading="lazy"
                    width="500"
                    height="500"
                  >
                {% else %}
                  <div class="ai-related-product-image-placeholder-{{ ai_gen_id }}">
                    {{ 'product-1' | placeholder_svg_tag }}
                  </div>
                {% endif %}
              </div>

              <div class="ai-related-product-content-{{ ai_gen_id }}">
                <h3 class="ai-related-product-title-{{ ai_gen_id }}">
                  <a href="{{ related_product.url }}">{{ related_product.title }}</a>
                </h3>

                <div class="ai-related-product-meta-{{ ai_gen_id }}">
                  {% liquid
                    assign shelf_life = related_product.metafields.custom.shelf_life
                    assign ingredients = related_product.metafields.custom.ingredients
                  %}

                  {% if shelf_life != blank %}
                    <div class="ai-related-product-meta-item-{{ ai_gen_id }}">
                      <span class="ai-related-product-meta-label-{{ ai_gen_id }}">Shelf Life:</span>
                      <span>{{ shelf_life }}</span>
                    </div>
                  {% endif %}

                  {% if ingredients != blank %}
                    <div class="ai-related-product-meta-item-{{ ai_gen_id }}">
                      <span class="ai-related-product-meta-label-{{ ai_gen_id }}">Ingredients:</span>
                      <span>{{ ingredients }}</span>
                    </div>
                  {% endif %}
                </div>
              </div>
            </div>
          {% endif %}
        {% endfor %}
      </div>
    </div>
  </div>
{% endif %}

{% schema %}
{
  "name": "Related products",
  "tag": null,
  "settings": [
    {
      "type": "header",
      "content": "Section"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Related Products"
    },
    {
      "type": "select",
      "id": "heading_alignment",
      "label": "Heading alignment",
      "options": [
        {
          "value": "left",
          "label": "Left"
        },
        {
          "value": "center",
          "label": "Center"
        },
        {
          "value": "right",
          "label": "Right"
        }
      ],
      "default": "left"
    },
    {
      "type": "range",
      "id": "heading_size",
      "min": 16,
      "max": 48,
      "step": 2,
      "unit": "px",
      "label": "Heading size",
      "default": 32
    },
    {
      "type": "range",
      "id": "heading_spacing",
      "min": 10,
      "max": 60,
      "step": 5,
      "unit": "px",
      "label": "Heading spacing",
      "default": 30
    },
    {
      "type": "range",
      "id": "section_padding",
      "min": 0,
      "max": 100,
      "step": 5,
      "unit": "px",
      "label": "Section padding",
      "default": 40
    },
    {
      "type": "header",
      "content": "Grid"
    },
    {
      "type": "range",
      "id": "grid_gap",
      "min": 10,
      "max": 50,
      "step": 5,
      "unit": "px",
      "label": "Gap between cards",
      "default": 20
    },
    {
      "type": "header",
      "content": "Card style"
    },
    {
      "type": "range",
      "id": "card_padding",
      "min": 10,
      "max": 40,
      "step": 2,
      "unit": "px",
      "label": "Card padding",
      "default": 16
    },
    {
      "type": "range",
      "id": "card_border_radius",
      "min": 0,
      "max": 24,
      "step": 2,
      "unit": "px",
      "label": "Card border radius",
      "default": 8
    },
    {
      "type": "range",
      "id": "card_border_width",
      "min": 0,
      "max": 4,
      "step": 1,
      "unit": "px",
      "label": "Card border width",
      "default": 1
    },
    {
      "type": "color",
      "id": "card_border_color",
      "label": "Card border color",
      "default": "#e6e6e6"
    },
    {
      "type": "color",
      "id": "card_background",
      "label": "Card background",
      "default": "#ffffff"
    },
    {
      "type": "header",
      "content": "Typography"
    },
    {
      "type": "range",
      "id": "product_title_size",
      "min": 12,
      "max": 24,
      "step": 1,
      "unit": "px",
      "label": "Product title size",
      "default": 16
    },
    {
      "type": "range",
      "id": "meta_text_size",
      "min": 10,
      "max": 18,
      "step": 1,
      "unit": "px",
      "label": "Meta text size",
      "default": 13
    },
    {
      "type": "header",
      "content": "Colors"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Background",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "heading_color",
      "label": "Heading",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "product_title_color",
      "label": "Product title",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "meta_text_color",
      "label": "Meta text",
      "default": "#666666"
    }
  ],
  "presets": [
    {
      "name": "Related products"
    }
  ]
}
{% endschema %}